# –í–∞—Ä–∏–∞–Ω—Ç 5 (Z9: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–∏–ø–æ—Ç–µ–∑—É –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏ –∫—Ä–∏—Ç–µ—Ä–∏–µ–º –í–∏–ª–∫–æ–∫—Å–æ–Ω–∞)
# Œ± = 0.025
# K: I-–∞—è –≥—Ä. –ë–æ–ª–ú–µ–Ω—å—à–µ

data1 <- read.csv('https://kms.kpfu.ru/sites/default/files/unmanaged/forstud/–ö—É—Ä—Å–æ–≤–∞—è%20—Ä–∞–±–æ—Ç–∞%20–ø–æ%20–¢–í–ú–°/813/7/r2z1.csv')

X <- data1$X
Y <- data1$Y

# –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –µ–¥–∏–Ω—ã–π —Ä—è–¥, –ø–æ–º–µ—Ç–∏–≤ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–µ —Ä–∞–∑–Ω—ã–º –≤—ã–±–æ—Ä–∫–∞–º.
XY <-  c(X, Y)
XY_TYPE <-  rep(c("X", "Y"), each = 19)
DATASET <- data.frame(XY_TYPE, XY, stringsAsFactors = TRUE)

# –ü—Ä–æ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è, –ø—Ä–∏–ø–∏—Å—ã–≤–∞—è –º–µ–Ω—å—à–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é –º–µ–Ω—å—à–∏–π —Ä–∞–Ω–≥. –í—Å–µ–≥–æ —Ä–∞–Ω–≥–æ–≤ –ø–æ–ª—É—á–∏—Ç—Å—è (n1 + n2).
DATASET$rank <- rank(XY)

# –¥–ª–∏–Ω–∞ –≤—ã–±–æ—Ä–æ–∫
n1 <- length(na.omit(X))
n2 <- length(Y)

# –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É —Ä–∞–Ω–≥–æ–≤ –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π –≤—ã–±–æ—Ä–∫–∏.
DATASET <- na.omit(DATASET)
sumXY <- tapply(DATASET$rank, DATASET$XY_TYPE, FUN=sum)


Sx <- sumXY[[1]]  # —Ä–∞–Ω–≥–æ–≤ X
Sy <- sumXY[[2]]  # —á–∏—Å–ª–æ Y

# –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–º–º —Ä–∞–Ω–≥–æ–≤
SxSy <- (n1+n2)*(n1+n2+1)/2
SxSy == Sx+Sy


# –ø—Ä–∏ –Ω—É–ª–µ–≤–æ–∏ÃÜ –≥–∏–ø–æ—Ç–µ–∑–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ W –∏–º–µ–µ—Ç —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –í–∏–ª–∫–æ–∫—Å–æ–Ω–∞ (Wilcoxon) —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (n1,n2)

# –º–∞—Ç –æ–∂–∏–¥–∞–Ω–∏–µ–º
MUw <- (n1*(n1+n2+1))/2 + 0.5 # –ß—Ç–æ–±—ã –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –±—ã–ª–æ –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º, –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –ø–æ–ø—Ä–∞–≤–∫–æ–π –ô–µ–π—Ç—Å–∞ –Ω–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç—å
# –¥–∏—Å–ø–µ—Ä—Å–∏–µ–∏ÃÜ
SIGMAw <- (n1*n2*(n1+n2+1))/12

W <- (Sx- MUw) * (SIGMAw)^(-1/2)


# –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –ø–æ–º–µ–Ω—è—Ç—å –≤—ã–±–æ—Ä–∫–∏ –º–µ—Å—Ç–∞–º–∏, –≤—Ç–æ—Ä—É—é –Ω–∞–∑–≤–∞—Ç—å –ø–µ—Ä–≤–æ–π? –¢–æ–≥–¥–∞ –≤–º–µ—Å—Ç–æ W –Ω–∞–¥–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å  W1 . –ò–º–µ–µ–º
MUw1 <- (n2*(n2+n1+1))/2 + 0.5
SIGMAw1 <- (n2*n1*(n2+n1+1))/12
W1 <- (Sy - MUw1) * (SIGMAw1)^(-1/2)
# –ø–æ—á–µ–º—É —Ç–æ —É –º–µ–Ω—è –Ω–µ —Å–æ—à–ª–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
# –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫—Ä–∏—Ç–µ—Ä–∏—è –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–Ω–∞–∫–æ–º (–º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —ç—Ç–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–µ—Ä–Ω–æ –≤—Å–µ–≥–¥–∞).
# –ü–æ—Å–∫–æ–ª—å–∫—É –≤ –ø—Ä–∞–≤–∏–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –≤–µ–ª–∏—á–∏–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏,
# —Ç–æ –ø—Ä–∏–Ω–∏–º–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫—É—é –≤—ã–±–æ—Ä–∫—É —Å—á–∏—Ç–∞–µ–º –ø–µ—Ä–≤–æ–π, –∞ –∫–∞–∫—É—é –≤—Ç–æ—Ä–æ–π.
# –î–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –æ–±—ä–µ–º–∞ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏–Ω—è—Ç–æ —Å—á–∏—Ç–∞—Ç—å –ø–µ—Ä–≤–æ–π –≤—ã–±–æ—Ä–∫—É –º–µ–Ω—å—à–µ–≥–æ –æ–±—ä–µ–º–∞.
T <- abs(W)







# –ò–∑ –∞—Å–∏–º–ø—Ç–æ—Ç–∏—á–µ—Å–∫–æ–π –Ω–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¢ —Å–ª–µ–¥—É–µ—Ç, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∫—Ä–∏—Ç–µ—Ä–∏—è –í–∏–ª–∫–æ–∫—Å–æ–Ω–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

# - –µ—Å–ª–∏ |T| < F(1 - Œ±/2) —Ç–æ –≥–∏–ø–æ—Ç–µ–∑–∞  –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏ (—Ç–æ–∂–¥–µ—Å—Ç–≤–∞) —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏  Œ±

# - –µ—Å–ª–∏ –∂–µ |T| > F(1 - Œ±/2) —Ç–æ –≥–∏–ø–æ—Ç–µ–∑–∞  –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ—Å—Ç–∏ (—Ç–æ–∂–¥–µ—Å—Ç–≤–∞) —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏  Œ± .

#  –í –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ Œ± = 0.025
#  –¢–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¢ –í–∏–ª–∫–æ–∫—Å–æ–Ω–∞ –Ω–∞–¥–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å –≥—Ä–∞–Ω–∏—á–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º F(1 - 0.025/2) = 0.9875

C1 <- qwilcox(0.9875, n1, n2)
–°2 <- qwilcox(0.025/2, n1, n2)


pwilcox(Sx, n1, n2)
# p > ùõº - —Ö–æ—Ä–æ—à–µ–µ —Å–æ–≥–ª–∞—Å–∏–µ —Å –Ω—É–ª–µ–≤–æ–∏ÃÜ –≥–∏–ø–æ—Ç–µ–∑–æ–∏ÃÜ
# –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –Ω—É–ª–µ–≤–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –æ—Ç–≤–µ—Ä–≥–∞–µ—Ç—Å—è.
# pwilcox ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–ª–µ–Ω–∏—è –í–∏–ª–∫–æ–∫—Å–æ–Ω–∞
# dwilcox ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –í–∏–ª–∫–æ–∫—Å–æ–Ω–∞
# qwilcox ‚Äî –∫–≤–∞–Ω—Ç–∏–ª—å —Ä–∞—Å–ø—Ä–µ–¥–ª–µ–Ω–∏—è –í–∏–ª–∫–æ–∫—Å–æ–Ω–∞





# –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à—É—é –∏–∑ –¥–≤—É—Ö —Ä–∞–Ω–≥–æ–≤—ã—Ö —Å—É–º–º.
maxXY <- sumXY[[which.max(sumXY)]]

# –º–∞–ª—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–∏—Ö —Ä–∞–Ω–≥–æ–≤ 1-–æ–∏ÃÜ –≤—ã–±–æ—Ä–∫–∏ –±—É–¥—É—Ç —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ø–æ–ª—å–∑—É –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
# –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∞—è —Å—Ä–µ–¥–Ω—è—è:
meanXY <- tapply(DATASET$rank, DATASET$XY_TYPE, FUN=mean)
meanXY[[1]] # X
meanXY[[2]] # Y
